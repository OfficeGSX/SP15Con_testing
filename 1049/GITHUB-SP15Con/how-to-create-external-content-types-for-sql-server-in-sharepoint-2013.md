---
title: Инструкции. Создание внешних типов контента для SQL Server в SharePoint 2013
ms.prod: SHAREPOINT
ms.assetid: 7fe2fbf0-546b-4a16-b02e-a0960bfb3842
---


# Инструкции. Создание внешних типов контента для SQL Server в SharePoint 2013
Информация о создании внешнего типа контента для SQL Server в SharePoint 2013.
Создание внешнего типа контента  это ключевая задача при работе с внешними данными. Внешний тип контента содержит важную информацию о подключениях, доступе, методах операции, столбцах, фильтрах и других метаданных, которые используются для получения данных из внешнего источника данных.
  
    
    


## Подготовка к работе
<a name="section1"> </a>

Работа с внешними данными требует выполнения нескольких предварительных задач, которые обеспечивают безопасный доступ к данным. Следующая информация поможет вам спланировать ваши дальнейшие действия. Кроме того, при возникновении проблем во время работы с внешними данными, эта информация поможет вам определить проблему. Чтобы получить доступ к внешним данным, вам или администратору необходимо выполнить следующие действия:
  
    
    
 **Подготовить SQL Server**. Администратор базы данных должен предоставить разрешения, чтобы убедиться, что доступ к данным предоставлен нужным пользователям и данные не попадут в чужие руки. Также он должен создать учетную запись SQL Server, которая имеет разрешения db_owner. Кроме того, администратор базы данных может создать специальные таблицы, представления, запросы, псевдонимы столбцов и так далее, чтобы ограничить результаты до необходимых и повысить производительность.
  
    
    
 **Настроить службы SharePoint**. Администратор должен активировать Службы Business Connectivity Services (BCS) и Служба Secure Store.
  
    
    
 **Настроить службу Secure Store**. Администратор должен определить наилучший режим доступа для внешнего источника данных, создать конечное приложение и задать учетные данные для конечного приложения.
  
    
    
 **Настроить службу подключения к бизнес-данным**. Администратор должен убедиться, что пользователь, создающий внешний тип данных, имеет разрешение на хранилище метаданных подключения к бизнес-данным (BDC) и что соответствующие пользователи имеют доступ к внешнему типу контента, на котором основан внешний список.
  
    
    
 **Убедиться, что Office 2013 готов к использованию.** Чтобы синхронизировать внешние данные с продуктами Office 2013, вы должны использовать Windows 7 или более поздние версии и убедиться, что параметр установки Office для Службы Business Connectivity Services (BCS) включен (по умолчанию). Этот параметр устанавливает Среда выполнения клиента Business Connectivity Services, который выполняет следующие действия: кэширует и синхронизирует внешние данные, сопоставляет бизнес-данные с внешними типами контента, отображает средство выбора внешних элементов в продуктах Office и запускает пользовательские решения внутри продуктов Office. Кроме того, на каждом клиентском компьютере должны быть установлены SQL Server Compact 4.0, .NET Framework 4 и службы данных WCF 5.0 для OData V3 (при необходимости вам автоматически будет предложено скачать программное обеспечение).
  
    
    

## Определение общих сведений
<a name="section2"> </a>


1. Запустите Microsoft SharePoint Designer 2013.
    
  
2. Щелкните кнопку **Открыть сайт** и затем введите соответствующее имя сайта.
    
  
3. На панели **Навигации** в разделе **Объекты сайта** выберите пункт **Внешние типы контента**.
    
    > **Примечание**
      > SharePoint Designer 2013 группирует внешние типы контента по пространству имен в начальном окне конструктора внешних типов данных. 
4. Чтобы открыть конструктор внешних типов данных на ленте щелкните **Внешний тип контента**.
    
  
5. На странице **Новый внешний тип контента** выполните следующие действия:
    
  - Радом с пунктом **Имя** щелкните пункт **Новый внешний тип контента**, а затем введите уникальное имя для этого внешнего типа контента.
    
  
  - Рядом с пунктом **Отображаемое имя** можете указать другое, более понятное имя.
    
  

## Определение общего поведения и поведения Office
<a name="section3"> </a>


1. В выпадающем списке **Тип элемента Microsoft Office** один из следующих типов:
    
  - **Универсальный список**. Выберите этот параметр для любого типа списка.
    
  
  - **Встреча, контакт, публикация или задача**. Выберите этот параметр, если вы создаете список, который ведет себя как элемент контакта, задачи, встречи или публикации для Outlook. Выбранный вами тип элемента Office определяет поведение Outlook, которое вы хотите прикрепить к внешнему типу контента. Например, внешний тип контента "Клиент" ведет себя так же, как собственный элемент "Контакт" в Outlook.
    
  
2. Убедитесь, что напротив пункта **Автономная синхронизация для внешнего списка** стоит флажок **Включено**, который устанавливается по умолчанию.
    
    > **Примечание**
      > Если отключить этот параметр, команда SharePoint **Подключиться к Outlook** для внешнего списка станет недоступна.

> **Примечание**
> Также должна быть активирована функция фермы и сайта **Автономная синхронизация для внешних списков**. Она активна по умолчанию на уровне фермы, но отключена на уровне сайта. 
  
    
    


## Создание подключения к внешним данным
<a name="section4"> </a>


1. Чтобы указать базу данных SQL Server для внешнего типа контента, нажмите пункт **Щелкните здесь для обнаружения внешних источников данных и определения операций**.
    
  
2. Щелкните **Добавить подключение**, выберите пункт **SQL Server** в диалоговом окне **Выбор типа внешнего источника данных**, а затем нажмите кнопку **ОК**.
    
  
3. В диалоговом окне **Подключение к серверу SQL Server** введите имя сервера, имя базы данных, описание (необязательно) и нажмите кнопку **ОК**.
    
  
4. Чтобы выбрать режим проверки подлинности, укажите один из следующих пунктов:
    
  - **Подключиться с удостоверением пользователя**. Используется режим сквозной проверки подлинности.
    
  
  - **Подключиться с олицетворенным удостоверением Windows**. Используется режим проверки подлинности учетных данных Windows. 
    
  
  - **Подключиться с олицетворенным настраиваемым удостоверением**. Используется режим проверки подлинности учетных данных RDB.
    
  
5. В поле **Идентификатор приложения Secure Store** введите имя идентификатора конечного приложения, созданного в Служба Secure Store.
    
  
6. Нажмите кнопку **ОК**.
    
  
SharePoint Designer 2013 проверяет и тестирует сведения о подключении. Если появятся сообщения, то для продолжения вам необходимо будет их устранить.
  
    
    

## Выбор таблицы, представления или процедуры
<a name="section5"> </a>


1. В проводнике источника данных разверните узел базы данных, чтобы просмотреть содержащиеся там таблицы, представления и процедуры.
    
  
2. Выберите таблицу, представление или процедуру.
    
  

## Определение операций
<a name="section6"> </a>


1. В проводнике источника данных щелкните правой кнопкой мыши таблицу, представление или процедуру, а затем выберите одну из следующих команд:
    
  - **Создать все операции**. Определяет операции создания, удаления, чтения, обновления элемента и чтения списка. 
    
    > **Примечание**
      > Команда **Создать все операции** доступна только для таблиц и представлений. Для процедур требуются специальные операции.
  - **Новая операция чтения элемента**. Определяет операцию чтения элемента.
    
  
  - **Новая операция чтения списка**. Определяет операцию чтения списка.
    
  
  - **Новая операция обновления**. Определяет операцию обновления элемента.
    
  
  - **Новая операция удаления прочитанного**. Определяет операцию удаления элемента.
    
  
  - **Обновить**. Обновляет список таблиц, представление и процедур в проводнике источника данных.
    
  
2. Нажмите кнопку **Далее**.
    
  
 **Примечания**
  
    
    

- В представлениях, которые охватывают несколько таблиц, убедитесь, что поддерживаются операции записи. В противном случае в командах **Создать все операции** или **Новая операция обновления** может произойти сбой.
    
  
- Всегда определяйте как минимум команды **Новая операция чтения элемента** и **Новая операция чтения списка**, так как функции SharePoint, например внешние списки, зависят от них.
    
  
- Если таблица или представление не поддерживают некоторые операции, выберите конкретные операции вместо команды **Создать все операции**.
    
  

## Добавление столбцов
<a name="section7"> </a>


1. Чтобы указать столбцы, которые нужно отобразить из таблицы или представления, нажмите кнопку **Далее**.
    
  
2. В диалоговом окне **Параметры конфигурации** по умолчанию выбраны все столбцы (известные как **Элементы источника данных**). Чтобы удалить ненужные столбцы, снимите соответствующие флажки.
    
    > **Примечание**
      > В отличие от собственного списка SharePoint, вы не можете изменить имя столбца внешнего списка. Воспользуйтесь псевдонимом столбца SQL, чтобы создать более понятное или более короткое имя. 
3. Чтобы выбрать поле идентификатора, щелкните и выделите поле (обычно это поле с уникальным значением), а затем в разделе **Свойства** щелкните кнопку **Сопоставить с идентификатором**.
    
  

> **Важно!**
> Чтобы предотвратить обновление определенных полей, например поле идентификатора или первичного ключа, снимите флажок напротив пункта **Обязательно**, но поставьте его напротив пункта **Только для чтения**, который требуется для извлечения элементов, чтобы вы могли обновлять другие поля. 
  
    
    

  
    
    


> **Совет**
> Всегда внимательно читайте сообщения на панели **Предупреждения и ошибки**. Они предоставляют полезную информацию, чтобы подтвердить ваши действия или устранить неполадки. Периодически щелкайте панель **Предупреждения и ошибки**, чтобы убедиться, что не появились ошибки или предупреждения. 
  
    
    


## Сопоставление полей Outlook
<a name="section8"> </a>

Если ваш внешний тип контента соответствует типу элемента Outlook, вы должны сопоставить одно или несколько полей из своего внешнего типа контента с полями элемента Outlook. При сопоставлении внешнего типа контента, например "Клиент", с типом элемента Outlook, например "Контакт", вы должны явно сопоставить отдельные поля из внешнего типа контента, например, "Фамилия клиента", "Имя клиента", "Адрес клиента" и "Телефон клиента" с соответствующими им полями элемента Outlook, например, "Имя", "Фамилия", "Рабочий адрес" и "Рабочий телефон" контакта.
  
    
    

- Для каждого поля выполните указанные ниже действия.
    
1. Щелкните и выделите поле.
    
  
2. В разделе **Свойства** рядом с пунктом **Свойство Office** щелкните стрелку вниз, а затем выберите соответствующее совпадающее поле.
    
  

> **Примечание**
> Вам не нужно сопоставлять все соответствующие поля. Однако поля, указанные в следующей таблице, должны быть сопоставлены. 
  
    
    


**Таблица. Тип элемента Outlook, сопоставленный полю элемента Outlook**


|**Тип элемента Outlook**|**Поле элемента Outlook**|
|:-----|:-----|
|Контакт  <br/> |Фамилия  <br/> |
|Задача  <br/> |Тема  <br/> |
|Встреча  <br/> |Начало, окончание и тема  <br/> |
|Публикация  <br/> |Тема  <br/> |
   
Несопоставленные поля в зависимости от номера отображаются в виде расширенных свойств следующим образом:
  
    
    

- **Смежное**. Прилагается к области формы в нижней части страницы по умолчанию для формы Outlook (от двух до пяти полей).
    
  
- **Отдельное**. Добавляется на форму Outlook в качестве новой страницы (от двух до пяти полей).
    
  

## Настройка элемента управления выбора внешних элементов
<a name="section9"> </a>

Средство управления выбора внешних элементов позволяет пользователям выбирать поля, например поле идентификатора или поле, содержащее уникальные значения, для удобного выбора элемента. Это средство управления доступно в SharePoint и продуктах Office 2013. Например, пользователи могут использовать его, чтобы выбрать элемент из внешнего списка клиентов, а Word 2013 позволяет использовать это средство управления с элементами управления контентом, которые связаны со столбцами внешних данных. Это хороший способ выбрать определенные столбцы, которые вы хотите отобразить в средстве управления выбора внешнего элемента, так как операция для показа всех столбцов, которая используется по умолчанию, в большинстве случаев не требуется.
  
    
    

1. Для каждого поля, которое вы хотите отобразить в средстве выбора внешнего элемента контента, щелкните и выделите поле, а затем в разделе **Свойства** поставьте флажок напротив пункта **Показать в средстве выбора**.
    
  
2. Нажмите кнопку **Далее**.
    
  

> **Примечание**
> Все определенные вами фильтры отображаются в средстве управления выбором внешних элементов. Несмотря на то что специальные фильтры нельзя удалить из средства управления выбором внешних элементов, вы можете определить фильтр по умолчанию, щелкнув кнопку **Используется по умолчанию** в диалоговом окне **Конфигурация фильтра** во время создания или изменения фильтра.
  
    
    


## Определение фильтров
<a name="section10"> </a>

Если вы не определили фильтр, внешний список возвратит все данные до предела регулирования Службы Business Connectivity Services (BCS) (по умолчанию это 2000 элементов) или все данные, которые определены в типе внешнего контента, если их количество меньше текущего значения предела регулирования. Кроме того, вся обработка результатов происходит в продукте SharePoint. Рекомендуется определить хотя бы один фильтр. В целом существует два типа фильтров, которые необходимо знать:
  
    
    

- **Фильтр источника данных**. Когда вы создаете фильтр типов внешнего контента, известный как фильтр источника данных, операция фильтрации происходит в пределах базы данных SQL Server. Это важно, когда вы работаете с большим количеством данных, так как вы можете разгрузить обработку из продуктов SharePoint во внешнюю базу данных и повысить производительность. После создания внешнего списка вы можете использовать фильтр источника данных, создав представление, которое определяет различные значения фильтров в разделе **Фильтр источника данных** на странице настроек **Представление списка**.
    
  
- **Фильтр SharePoint**. Пользователи по-прежнему могут фильтровать данные с помощью фильтра SharePoint, либо фильтром заголовков столбца, либо с помощью раздела **Фильтры** на странице настроек **Представление списка**. В этом случае операция фильтрации проходит в пределах продукта SharePoint, а не базы данных SQL Server.
    
  
Хорошая стратегия  создать набор представлений внешних списков, основанных на определенных фильтрах источников данных, который гарантирует, что большие объемы данных сначала будут отфильтрованы во внешнем источнике данных, а затем пользователи смогут отфильтровать и уточнить результаты с помощью фильтров SharePoint.
  
    
    
Вы можете создать несколько различных типов фильтров. Для каждого создаваемого фильтра необходимо выполнить следующее:
  
    
    

1. Выберите поле в разделе **Свойства** рядом с пунктом **Элемент источника данных**.
    
  
2. В разделе **Свойства** рядом с пунктом **Фильтр** нажмите ссылку **Щелкните, чтобы добавить**, чтобы открыть диалоговое окно **Конфигурация фильтра**.
    
  
3. Щелкните **Добавить параметр фильтра**.
    
  
4. В поле **Создать фильтр** введите имя фильтра.
    
  
5. В поле **Тип фильтра** выберите тип фильтра:
    
    
  
    
    
 **Сравнения**
  
    
    

    
Фильтр сравнения ограничивает элементы, которые возвращаются в зависимости от условия (например, Штат = "Нью-Джерси"), и преобразуется в SQL-предложение WHERE.
    
1. В поле **Тип фильтра** выберите пункт **Сравнение**.
    
  
2. В поле **Оператор** выберите операцию.
    
  
3. Убедитесь, что в поле **Поле фильтра** выбрано необходимое для сравнения.
    
  
4. Если вы хотите, чтобы значения, введенные пользователем, соответствовали регистру, выберите пункт **С учетом регистра**.
    
  
5. Если вы хотите отобразить список возможных соответствий в средстве управления выбором внешних элементов в случае обнаружения более одного соответствующего элемента, выберите пункт **Использовать для создания списка соответствий в средстве выбора внешних элементов**.
    
  
6. Нажмите кнопку **ОК**.
    
  
7.  В разделе **Свойства** рядом с полем **Значение по умолчанию** введите начальное значение, по которому будет производиться фильтрация в случае, если пользователь не введет значение. Если вы оставите это поле пустым, внешний список не отобразит никаких элементов.
    
  

    
  
    
    
 **Подстановочные знаки**
  
    
    

    
Фильтр с подстановочными знаками ограничивает элементы, которые возвращаются на основе введенного пользователем значения строки (например, Штат содержит "Нью"), и преобразуется в SQL-предложение LIKE. Допустимые подстановочные символы SQL Server  * (звездочка), которая соответствует любому количеству символов, и _ (символ подчеркивания), который соответствует только одному символу. 
  
    
    

    
1. В поле **Тип фильтра** выберите пункт **Подстановочный знак**.
    
  
2. В поле **Поле фильтра** выберите нужное.
    
  
3. Если вы хотите, чтобы значения, введенные пользователем, соответствовали регистру, выберите пункт **С учетом регистра**.
    
  
4. Если вы хотите отобразить список возможных соответствий в средстве управления выбором внешних элементов в случае обнаружения более одного соответствующего элемента, выберите пункт **Использовать для создания списка соответствий в средстве выбора внешних элементов**.
    
  
5. Нажмите кнопку **ОК**.
    
  
6.  В разделе **Свойства** рядом с полем **Значение по умолчанию** введите начальное значение, по которому будет производиться фильтрация в случае, если пользователь не введет значение. Если вы оставите это поле пустым, внешний список не отобразит никаких элементов. Рекомендуется ввести знак * (звездочка) в качестве значения по умолчанию.
    
  

    
  
    
    
 **Ограничение**
  
    
    

    
В большинстве случаев вы можете определить ограничивающий фильтр для операций чтения и чтения списка. Если вы не определите значение **Ограничения по умолчанию**, никакие данные не будут извлечены из внешнего источника данных. Убедитесь, что введенное вами значение по умолчанию для ограничивающего фильтра меньше 2000, так как регулирование Службы Business Connectivity Services (BCS) по умолчанию равно 2000 элементов. При необходимости вы можете увеличить данное значение.
    
1. В поле **Тип фильтра** выберите пункт **Ограничение**. 
    
  
2. В поле **Число** введите число ограничений.
    
  
3. Если вы хотите отобразить список возможных соответствий в средстве управления выбором внешних элементов в случаях, когда обнаружено более одного соответствующего элемента, выберите пункт **Использовать для создания списка соответствий в средстве выбора внешних элементов**.
    
  
4. В разделе **Свойства** рядом с полем **Значение по умолчанию** введите начальное значение, по которому будет производиться фильтрация в случае, если пользователь не введет значение. Если вы оставите это поле пустым, внешний список не отобразит никаких элементов.
    
  
5. Нажмите кнопку **ОК**.
  
    
    

    
  

    > **Примечание**
      > Администратор базы данных SQL Server может создать специальные таблицы, представления, индексы и оптимизированные запросы, чтобы ограничить результаты до лишь необходимых данных и повысить производительность. 

    
  
    
    
 **Номер страницы**
  
    
    

    
    Используйте внешний тип контента "Номер страницы", чтобы заменить ограничение страниц SharePoint, определенных на странице **Представление списка** внешнего списка. Вот отличия:
    
  - Внешний тип контента "Номер страницы" сначала обрабатывает результаты в пределах базы данных SQL Server, а затем возвращает и отображает только то количество строк, которое определено значением "Размер страницы".
    
  
  - Ограничение страниц SharePoint возвращает все строки в "Значение по умолчанию" из базы данных SQL Server, а затем отображает количество строк, определенное значением ограничения страниц SharePoint на странице настроек **Представление списка**.
    
  

    Использование внешнего типа контента "Номер страницы" в целом более эффективно. Кроме того, значение **Порядок** помогает убедиться, что возвращено точное отображение результатов.
    
1. В поле **Тип фильтра** выберите пункт **Номер страницы**. 
    
  
2. В поле **Размер страницы** введите число.
    
  
3. В поле **Порядок** выберите направление сортировки.
    
  
4. Нажмите кнопку **ОК**. 
    
  
5. В разделе **Свойства** рядом с полем **Значение по умолчанию** введите начальное значение, по которому будет производиться фильтрация в случае, если пользователь не введет значение. Если вы оставите это поле пустым, внешний список не отобразит никаких элементов.
  
    
    

    
  
6. Если вы хотите отобразить поле, но не изменять его, щелкните и выделите это поле, а затем в разделе **Свойства** установите флажок **Только для чтения**.
    
  
7. Если вы хотите убедиться, что поле всегда имеет значение созданного при его создании или изменении, щелкните и выделите это поле, а затем в разделе **Свойства** установите флажок **Обязательно**.
    
  
8. Чтобы предоставить описательное имя в средстве управления выбором внешнего элемента для имени **Элемента источника данных**, которое является производным от имени столбца SQL Server, щелкните и выделите поле, а затем введите имя в разделе **Свойства** в поле **Отображаемое имя**.
    
  
9. Чтобы определить значение по умолчанию для фильтра (которое также отображается в разделе **Фильтр источника данных** на странице настроек **Представление списка**), в разделе **Параметры фильтра** щелкните и выделите фильтр, а затем введите соответствующее значение в поле **Значение по умолчанию**. Если вы не введете значение, то при первом использовании фильтра не будут отображены никакие элементы.
    
  

## Настройка поля "Заголовок" для внешнего списка
<a name="section11"> </a>


1. На ленте щелкните кнопку **Представление сводки**.
    
  
2. В разделе **Поля** под пунктом **Имя поля** выберите поле.
    
    > **Важно!**
      > В общем случае рекомендуется задать полю "Заголовок" уникальное значение. Это поле используется для отображения списка или форм InfoPath. После установки поля "Заголовок" изменить его невозможно. 
3. На ленте нажмите кнопку **Установить в качестве заголовка**.
    
  

## Завершение создания внешнего типа контента
<a name="section12"> </a>


- На панели быстрого доступа нажмите кнопку **Сохранить**. Так вы сохраните определение внешнего типа контента в хранилище метаданных службы подключения к бизнес-данным (BDC).
    
  

> **Примечание**
> Чтобы обеспечить высокую производительность, служба подключения к бизнес-данным кэширует все объекты и хранилище метаданных и обновляет изменения с помощью задания таймера, которое запускается каждую минуту. Распространение изменений на все серверы в ферме может занять до одной минуты, однако внесенные на сервер изменения вступают в силу мгновенно. 
  
    
    

Теперь внешний тип контента доступен для использования в SharePoint и продуктах Office 2013.
  
    
    

## Дополнительные ресурсы
<a name="AR"> </a>


-  [Внешние типы контента в SharePoint 2013](external-content-types-in-sharepoint-2013.md)
    
  
-  [Deploy a Business Connectivity Services on-premises solution in SharePoint 2013](http://msdn.microsoft.com/library/4692ebba-90eb-4d72-ac12-e90c4d4ee7ae.aspx)
    
  
-  [Использование источников OData со службами Business Connectivity Services в SharePoint 2013](using-odata-sources-with-business-connectivity-services-in-sharepoint-2013.md)
    
  
-  [Configure the Secure Store Service in SharePoint 2013](http://msdn.microsoft.com/library/29C0BC76-D835-401B-A2FB-ABB069E84125.aspx)
    
  

